<!-- Header Section -->
<header class="app-header">
  <div class="header-content">
    <div class="logo-section">
      <div class="logo">🔗</div>
      <div class="title">
        <h1>Profile Data System</h1>
        <p>Blockchain-powered profile management with Hedera integration</p>
      </div>
    </div>
    <div class="header-info">
      <div class="status-indicator">
        <span class="status-dot"></span>
        <span class="status-text">API Disconnected</span>
      </div>
      <div class="status-indicator">
        <span class="status-dot connected"></span>
        <span class="status-text">Blockchain Connected</span>
      </div>
    </div>
  </div>
</header>

<!-- Navigation Tabs -->
<nav class="tab-navigation">
  <div class="tab-container">
    <div class="tabs">
      <button 
        class="tab" 
        [class.active]="activeTab === 'create'"
        (click)="setActiveTab('create')">
        <span class="tab-icon">➕</span>
        <span class="tab-label">Create Profile</span>
      </button>
      <button 
        class="tab" 
        [class.active]="activeTab === 'read'"
        (click)="setActiveTab('read')">
        <span class="tab-icon">📖</span>
        <span class="tab-label">Read Profile</span>
      </button>
      <button 
        class="tab" 
        [class.active]="activeTab === 'update'"
        (click)="setActiveTab('update')">
        <span class="tab-icon">✏️</span>
        <span class="tab-label">Update Profile</span>
      </button>
      <button 
        class="tab" 
        [class.active]="activeTab === 'regulator'"
        (click)="setActiveTab('regulator')">
        <span class="tab-icon">🔍</span>
        <span class="tab-label">Regulator Profile</span>
      </button>
    </div>
  </div>
</nav>

<!-- Messages Section -->
<div class="messages-container" *ngIf="errorMessage || successMessage">
  <div class="message error" *ngIf="errorMessage">
    <span class="message-icon">⚠️</span>
    <span class="message-text">{{ errorMessage }}</span>
  </div>
  <div class="message success" *ngIf="successMessage">
    <span class="message-icon">✅</span>
    <span class="message-text">{{ successMessage }}</span>
  </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" *ngIf="isLoading">
  <div class="loading-spinner">
    <div class="spinner"></div>
  </div>
</div>

<!-- Tab Content -->
<main class="tab-content">
  <div class="content-wrapper">
    
    <!-- CREATE PROFILE TAB -->
    <div *ngIf="activeTab === 'create'" class="tab-panel">
      <div class="create-profile-container">
        <!-- Header -->
        <div class="header-section">
          <h1>➕ Create Company Profile</h1>
          <p>Create a new company profile and receive a private key for secure editing</p>
        </div>

        <!-- Create Profile Form -->
        <form [formGroup]="createForm" (ngSubmit)="createProfile()" class="form-section">
          <div class="form-card">
            <h2>📋 Company Profile Form</h2>
            
            <!-- Company Information -->
            <div class="form-group">
              <label for="company_name">Company Name *</label>
              <input 
                type="text" 
                id="company_name"
                formControlName="company_name"
                class="form-input"
                placeholder="Enter company name">
              <div class="error-message" *ngIf="createForm.get('company_name')?.invalid && createForm.get('company_name')?.touched">
                Company name is required
              </div>
            </div>

            <div class="form-group">
              <label for="location">Location *</label>
              <input 
                type="text" 
                id="location"
                formControlName="location"
                class="form-input"
                placeholder="Enter company location">
              <div class="error-message" *ngIf="createForm.get('location')?.invalid && createForm.get('location')?.touched">
                Location is required
              </div>
            </div>

            <div class="form-group">
              <label for="contact">Contact Information *</label>
              <input 
                type="text" 
                id="contact"
                formControlName="contact"
                class="form-input"
                placeholder="Email | Phone">
              <div class="error-message" *ngIf="createForm.get('contact')?.invalid && createForm.get('contact')?.touched">
                Contact information is required
              </div>
            </div>

            <div class="form-group">
              <label for="size">Company Size *</label>
              <input 
                type="text" 
                id="size"
                formControlName="size"
                class="form-input"
                placeholder="e.g., 500+ employees">
              <div class="error-message" *ngIf="createForm.get('size')?.invalid && createForm.get('size')?.touched">
                Company size is required
              </div>
            </div>

            <div class="form-group">
              <label for="established">Year Established *</label>
              <input 
                type="text" 
                id="established"
                formControlName="established"
                class="form-input"
                placeholder="e.g., 2015">
              <div class="error-message" *ngIf="createForm.get('established')?.invalid && createForm.get('established')?.touched">
                Year established is required
              </div>
            </div>

            <div class="form-group">
              <label for="revenue">Revenue Range *</label>
              <input 
                type="text" 
                id="revenue"
                formControlName="revenue"
                class="form-input"
                placeholder="e.g., $50M - $100M">
              <div class="error-message" *ngIf="createForm.get('revenue')?.invalid && createForm.get('revenue')?.touched">
                Revenue range is required
              </div>
            </div>

            <!-- Market Segments -->
            <div class="form-group">
              <label>Market Segments</label>
              <div formArrayName="market_segments" class="array-inputs">
                <div *ngFor="let segment of marketSegmentsArray.controls; let i = index" class="array-item">
                  <input 
                    type="text" 
                    [formControlName]="i"
                    class="form-input"
                    placeholder="Enter market segment">
                  <button type="button" class="remove-btn" (click)="removeArrayItem(marketSegmentsArray, i)">❌</button>
                </div>
                <button type="button" class="add-btn" (click)="addArrayItem(marketSegmentsArray)">➕ Add Market Segment</button>
              </div>
            </div>

            <!-- Technology Focus -->
            <div class="form-group">
              <label>Technology Focus</label>
              <div formArrayName="technology_focus" class="array-inputs">
                <div *ngFor="let tech of technologyFocusArray.controls; let i = index" class="array-item">
                  <input 
                    type="text" 
                    [formControlName]="i"
                    class="form-input"
                    placeholder="Enter technology focus">
                  <button type="button" class="remove-btn" (click)="removeArrayItem(technologyFocusArray, i)">❌</button>
                </div>
                <button type="button" class="add-btn" (click)="addArrayItem(technologyFocusArray)">➕ Add Technology Focus</button>
              </div>
            </div>

            <!-- Key Markets -->
            <div class="form-group">
              <label>Key Markets</label>
              <div formArrayName="key_markets" class="array-inputs">
                <div *ngFor="let market of keyMarketsArray.controls; let i = index" class="array-item">
                  <input 
                    type="text" 
                    [formControlName]="i"
                    class="form-input"
                    placeholder="Enter key market">
                  <button type="button" class="remove-btn" (click)="removeArrayItem(keyMarketsArray, i)">❌</button>
                </div>
                <button type="button" class="add-btn" (click)="addArrayItem(keyMarketsArray)">➕ Add Key Market</button>
              </div>
            </div>

            <!-- Customer Segments -->
            <div class="form-group">
              <label>Customer Segments</label>
              <div formArrayName="customer_segments" class="array-inputs">
                <div *ngFor="let segment of customerSegmentsArray.controls; let i = index" class="array-item">
                  <input 
                    type="text" 
                    [formControlName]="i"
                    class="form-input"
                    placeholder="Enter customer segment">
                  <button type="button" class="remove-btn" (click)="removeArrayItem(customerSegmentsArray, i)">❌</button>
                </div>
                <button type="button" class="add-btn" (click)="addArrayItem(customerSegmentsArray)">➕ Add Customer Segment</button>
              </div>
            </div>

            <div class="form-group">
              <label for="competitive_position">Competitive Position *</label>
              <textarea 
                id="competitive_position"
                formControlName="competitive_position"
                class="form-textarea"
                placeholder="Describe your competitive position in the market"></textarea>
              <div class="error-message" *ngIf="createForm.get('competitive_position')?.invalid && createForm.get('competitive_position')?.touched">
                Competitive position is required
              </div>
            </div>

            <!-- Partnerships -->
            <div class="form-group">
              <label>Partnerships</label>
              <div formArrayName="partnerships" class="array-inputs">
                <div *ngFor="let partner of partnershipsArray.controls; let i = index" class="array-item">
                  <input 
                    type="text" 
                    [formControlName]="i"
                    class="form-input"
                    placeholder="Enter partnership">
                  <button type="button" class="remove-btn" (click)="removeArrayItem(partnershipsArray, i)">❌</button>
                </div>
                <button type="button" class="add-btn" (click)="addArrayItem(partnershipsArray)">➕ Add Partnership</button>
              </div>
            </div>

            <!-- Certifications -->
            <div class="form-group">
              <label>Certifications</label>
              <div formArrayName="certifications" class="array-inputs">
                <div *ngFor="let cert of certificationsArray.controls; let i = index" class="array-item">
                  <input 
                    type="text" 
                    [formControlName]="i"
                    class="form-input"
                    placeholder="Enter certification">
                  <button type="button" class="remove-btn" (click)="removeArrayItem(certificationsArray, i)">❌</button>
                </div>
                <button type="button" class="add-btn" (click)="addArrayItem(certificationsArray)">➕ Add Certification</button>
              </div>
            </div>

            <!-- Sales Channels -->
            <div class="form-group">
              <label>Sales Channels</label>
              <div formArrayName="sales_channels" class="array-inputs">
                <div *ngFor="let channel of salesChannelsArray.controls; let i = index" class="array-item">
                  <input 
                    type="text" 
                    [formControlName]="i"
                    class="form-input"
                    placeholder="Enter sales channel">
                  <button type="button" class="remove-btn" (click)="removeArrayItem(salesChannelsArray, i)">❌</button>
                </div>
                <button type="button" class="add-btn" (click)="addArrayItem(salesChannelsArray)">➕ Add Sales Channel</button>
              </div>
            </div>

            <!-- Private Key -->
            <div class="form-group">
              <label for="private_key">Private Key *</label>
              <div class="private-key-section">
                <input 
                  type="password" 
                  id="private_key"
                  formControlName="private_key"
                  class="form-input"
                  placeholder="Enter your private key">
                <button type="button" class="btn btn-secondary" (click)="generatePrivateKey()" style="margin-left: 10px;">
                  🔑 Generate Private Key
                </button>
              </div>
              <div class="error-message" *ngIf="createForm.get('private_key')?.invalid && createForm.get('private_key')?.touched">
                Private key is required
              </div>
              <div class="security-note">
                <p><strong>Security Note:</strong> This private key will be used to authorize future profile updates. Store it securely!</p>
              </div>
            </div>

            <!-- Submit Button -->
             <div class="form-actions">
                           <button type="submit" class="btn btn-primary" [disabled]="createForm.invalid || isLoading">
              <span *ngIf="!isLoading"> Create Profile</span>
              <span *ngIf="isLoading"></span>
            </button>
             </div>
           </div>
         </form>

         <!-- Create Profile Success Display -->
         <div class="create-success-section" *ngIf="showCreateSuccess && createdProfileData">
           <div class="success-card">
             <div class="success-header">
               <div class="success-icon">✅</div>
               <h2>Profile Created Successfully!</h2>
               <p>Your company profile has been stored on the blockchain. Please securely save your private key.</p>
             </div>

             <!-- Security Warning -->
             <div class="security-warning">
               <div class="warning-icon">⚠️</div>
               <div class="warning-content">
                 <h3>Security Warning</h3>
                 <p><strong>IMPORTANT:</strong> Your private key is required for all future profile updates and cannot be recovered by the backend. Please save it securely!</p>
                 <ul>
                   <li>Store your private key in a secure location</li>
                   <li>Never share your private key with anyone</li>
                   <li>Consider using a password manager or hardware wallet</li>
                   <li>Make multiple backups in different secure locations</li>
                 </ul>
               </div>
             </div>

             <!-- Profile Information -->
             <div class="profile-info-grid">
               <div class="info-item">
                 <label>File ID</label>
                 <div class="info-value">
                   <span class="value-text">{{ createdProfileData.file_id }}</span>
                   <button class="copy-btn" (click)="copyToClipboard(createdProfileData.file_id, 'File ID')">
                     📋 Copy
                   </button>
                 </div>
               </div>

               <div class="info-item">
                 <label>Public Key</label>
                 <div class="info-value">
                   <span class="value-text">{{ createdProfileData.public_key }}</span>
                   <button class="copy-btn" (click)="copyToClipboard(createdProfileData.public_key, 'Public Key')">
                     📋 Copy
                   </button>
                 </div>
               </div>

               <div class="info-item private-key-item">
                 <label>Private Key</label>
                 <div class="info-value">
                   <span class="value-text private-key">{{ createdProfileData.private_key }}</span>
                   <div class="private-key-actions">
                     <button class="copy-btn" (click)="copyToClipboard(createdProfileData.private_key, 'Private Key')">
                       📋 Copy
                     </button>
                     <button class="download-btn" (click)="downloadPrivateKey()">
                       💾 Download
                     </button>
                   </div>
                 </div>
               </div>

                                     <div class="info-item" *ngIf="createdProfileData.verification_url">
                        <label>Verification URL</label>
                        <div class="info-value">
                          <a [href]="createdProfileData.verification_url" target="_blank" class="verification-link">
                            🔗 View Profile
                          </a>
                        </div>
                      </div>
                    </div>

                    <!-- QR Code Section -->
                    <div class="qr-section" *ngIf="createdProfileData.qr_code_data">
                      <h3>QR Code</h3>
                      <div class="qr-container">
                        <div class="qr-code-text">{{ createdProfileData.qr_code_data }}</div>
                        <p>Scan this QR code to view your profile</p>
                      </div>
                    </div>

             <!-- Action Buttons -->
             <div class="success-actions">
               <button class="btn btn-secondary" (click)="closeCreateSuccess()">
                 ✨ Create Another Profile
               </button>
               <button class="btn btn-primary" (click)="setActiveTab('update')">
                 ✏️ Update Profile
               </button>
             </div>
           </div>
         </div>
       </div>
     </div>

    <!-- READ PROFILE TAB -->
    <div *ngIf="activeTab === 'read'" class="tab-panel">
      <div class="read-profile-container">
        <!-- Header -->
        <div class="header-section">
          <h1>📖 Read Single Latest Profile</h1>
          <p>View the single most recently created or updated company profile from the blockchain</p>
        </div>

        <!-- Debug Info -->
        

        <!-- Loading State -->
        <div class="loading-state" *ngIf="readProfileLoading">
          <div class="loading-spinner">
            <div class="spinner"></div>
          </div>
        </div>

        <!-- Error State -->
        <div class="error-state" *ngIf="readProfileError && !readProfileLoading">
          <div class="error-card">
            <div class="error-icon">❌</div>
            <h3>Error Loading Latest Profile</h3>
            <p>{{ readProfileError }}</p>
            <button class="btn btn-primary" (click)="loadSingleLatestProfile()">🔄 Retry</button>
          </div>
        </div>

        <!-- Profile Display -->
        <div class="profile-display" *ngIf="currentProfile && !readProfileLoading">
          <div class="profile-card">
            <!-- Profile Metadata -->
            <div class="profile-metadata" *ngIf="latestProfileData">
              <div class="metadata-grid">
                <div class="metadata-item">
                  <label>File ID</label>
                  <span>{{ latestProfileData.metadata.file_id }}</span>
                </div>
                <div class="metadata-item">
                  <label>Version</label>
                  <span>{{ latestProfileData.metadata.version }}</span>
                </div>
                <div class="metadata-item">
                  <label>Last Updated</label>
                  <span>{{ latestProfileData.metadata.updated_at | date:'medium' }}</span>
                </div>
                <div class="metadata-item">
                  <label>Signature Verified</label>
                  <span [class.verified]="latestProfileData.signature_verified">
                    {{ latestProfileData.signature_verified ? '✅ Verified' : '❌ Not Verified' }}
                  </span>
                </div>
              </div>
            </div>

            <div class="profile-header">
              <h2>{{ currentProfile.company_name }}</h2>
              <div class="profile-meta">
                <span class="meta-item">📍 {{ currentProfile.location }}</span>
                <span class="meta-item">👥 {{ currentProfile.size }}</span>
                <span class="meta-item">📅 Established: {{ currentProfile.established }}</span>
              </div>
            </div>

            <div class="profile-section">
              <h3>📞 Contact Information</h3>
              <p>{{ currentProfile.contact }}</p>
            </div>

            <div class="profile-section">
              <h3>💰 Revenue</h3>
              <p>{{ currentProfile.revenue }}</p>
            </div>

            <div class="profile-section">
              <h3>🎯 Market Segments</h3>
              <div class="tags" *ngIf="currentProfile.market_segments.length > 0">
                <span class="tag" *ngFor="let segment of currentProfile.market_segments">{{ segment }}</span>
              </div>
              <p *ngIf="currentProfile.market_segments.length === 0" class="no-data">No market segments specified</p>
            </div>

            <div class="profile-section">
              <h3>🔬 Technology Focus</h3>
              <div class="tags" *ngIf="currentProfile.technology_focus.length > 0">
                <span class="tag" *ngFor="let tech of currentProfile.technology_focus">{{ tech }}</span>
              </div>
              <p *ngIf="currentProfile.technology_focus.length === 0" class="no-data">No technology focus specified</p>
            </div>

            <div class="profile-section">
              <h3>🌍 Key Markets</h3>
              <div class="tags" *ngIf="currentProfile.key_markets.length > 0">
                <span class="tag" *ngFor="let market of currentProfile.key_markets">{{ market }}</span>
              </div>
              <p *ngIf="currentProfile.key_markets.length === 0" class="no-data">No key markets specified</p>
            </div>

            <div class="profile-section">
              <h3>👥 Customer Segments</h3>
              <div class="tags" *ngIf="currentProfile.customer_segments.length > 0">
                <span class="tag" *ngFor="let segment of currentProfile.customer_segments">{{ segment }}</span>
              </div>
              <p *ngIf="currentProfile.customer_segments.length === 0" class="no-data">No customer segments specified</p>
            </div>

            <div class="profile-section">
              <h3>🏆 Competitive Position</h3>
              <p>{{ currentProfile.competitive_position || 'No competitive position specified' }}</p>
            </div>

            <div class="profile-section">
              <h3>🤝 Partnerships</h3>
              <div class="tags" *ngIf="currentProfile.partnerships.length > 0">
                <span class="tag" *ngFor="let partner of currentProfile.partnerships">{{ partner }}</span>
              </div>
              <p *ngIf="currentProfile.partnerships.length === 0" class="no-data">No partnerships specified</p>
            </div>

            <div class="profile-section">
              <h3>🏅 Certifications</h3>
              <div class="tags" *ngIf="currentProfile.certifications.length > 0">
                <span class="tag" *ngFor="let cert of currentProfile.certifications">{{ cert }}</span>
              </div>
              <p *ngIf="currentProfile.certifications.length === 0" class="no-data">No certifications specified</p>
            </div>

            <div class="profile-section">
              <h3>📈 Sales Channels</h3>
              <div class="tags" *ngIf="currentProfile.sales_channels.length > 0">
                <span class="tag" *ngFor="let channel of currentProfile.sales_channels">{{ channel }}</span>
              </div>
              <p *ngIf="currentProfile.sales_channels.length === 0" class="no-data">No sales channels specified</p>
            </div>
          </div>
        </div>

        <!-- No Profile Message -->
        <div class="no-profile" *ngIf="!currentProfile && !readProfileLoading && !readProfileError">
          <div class="empty-state">
            <div class="empty-icon">📖</div>
            <h3>No Latest Profile Available</h3>
            <p>No company profiles have been created yet. Create a profile first to view it here.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- UPDATE PROFILE TAB -->
    <div *ngIf="activeTab === 'update'" class="tab-panel">
      <div class="update-profile-container">
        <!-- Header -->
        <div class="header-section">
          <h1>✏️ Update Company Profile</h1>
          <p>Enter your private key to load and update your company profile</p>
        </div>

        <!-- Update Profile Messages -->
        <div class="messages-container" *ngIf="updateProfileError || updateProfileSuccess">
          <div class="message error" *ngIf="updateProfileError">
            <span class="message-icon">⚠️</span>
            <span class="message-text">{{ updateProfileError }}</span>
          </div>
          <div class="message success" *ngIf="updateProfileSuccess">
            <span class="message-icon">✅</span>
            <span class="message-text">{{ updateProfileSuccess }}</span>
          </div>
        </div>

        <!-- Update Profile Loading Overlay -->
        <div class="loading-overlay" *ngIf="updateProfileLoading">
          <div class="loading-spinner">
            <div class="spinner"></div>
          </div>
        </div>

        <!-- Private Key Form -->
        <div class="private-key-section" *ngIf="!privateKeyValidated && !updateProfileLoading">
          <div class="form-card">
            <h2>🔐 Private Key Authentication</h2>
            <p>Enter your private key to access and edit your profile</p>
            
            <!-- Security Warning -->
            <div class="security-warning">
              <div class="warning-icon">⚠️</div>
              <div class="warning-content">
                <h3>Security Notice</h3>
                <p><strong>IMPORTANT:</strong> Only the original private key used during profile creation can authorize updates.</p>
                <ul>
                  <li>Enter the exact private key from your profile creation</li>
                  <li>This key is required to validate your ownership</li>
                  <li>If you've lost your private key, you cannot update this profile</li>
                  <li>Consider creating a new profile if you cannot locate your private key</li>
                </ul>
              </div>
            </div>
            
            <form [formGroup]="privateKeyForm" (ngSubmit)="validatePrivateKey()" class="private-key-form">
              <div class="form-group">
                <label for="private_key">Private Key *</label>
                <input 
                  type="password" 
                  id="private_key"
                  formControlName="private_key"
                  class="form-input"
                  placeholder="Enter your private key">
                <div class="error-message" *ngIf="privateKeyForm.get('private_key')?.invalid && privateKeyForm.get('private_key')?.touched">
                  Private key is required
                </div>
              </div>

              <div class="form-actions">
                            <button type="submit" class="btn btn-primary" [disabled]="privateKeyForm.invalid || updateProfileLoading">
              <span *ngIf="!updateProfileLoading">🔓 Validate & Load Profile</span>
              <span *ngIf="updateProfileLoading"></span>
            </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Update Profile Form -->
        <div class="update-form-section" *ngIf="privateKeyValidated && currentProfile && !updateProfileLoading">
          <div class="form-card">
            <div class="profile-info">
              <h2>📝 Edit Profile: {{ currentProfile.company_name }}</h2>
              <p><strong>File ID:</strong> {{ fileId }}</p>
              <p><strong>Public Key:</strong> {{ publicKey }}</p>
              <p><strong>Authorization:</strong> ✅ Private key validated</p>
            </div>

            <!-- Authorization Success Message -->
            <div class="authorization-success">
              <div class="success-icon">🔐</div>
              <div class="success-content">
                <h3>Profile Loaded Successfully</h3>
                <p>Your private key has been validated. You can now edit the profile data below.</p>
                <p><strong>Note:</strong> You must enter your private key again in the form below to authorize the update.</p>
              </div>
            </div>

            <form [formGroup]="updateForm" (ngSubmit)="updateProfile()" class="update-form">
              <!-- Company Information -->
              <div class="form-group">
                <label for="update_company_name">Company Name *</label>
                <input 
                  type="text" 
                  id="update_company_name"
                  formControlName="company_name"
                  class="form-input">
                <div class="error-message" *ngIf="updateForm.get('company_name')?.invalid && updateForm.get('company_name')?.touched">
                  Company name is required
                </div>
              </div>

              <div class="form-group">
                <label for="update_location">Location *</label>
                <input 
                  type="text" 
                  id="update_location"
                  formControlName="location"
                  class="form-input">
                <div class="error-message" *ngIf="updateForm.get('location')?.invalid && updateForm.get('location')?.touched">
                  Location is required
                </div>
              </div>

              <div class="form-group">
                <label for="update_contact">Contact Information *</label>
                <input 
                  type="text" 
                  id="update_contact"
                  formControlName="contact"
                  class="form-input">
                <div class="error-message" *ngIf="updateForm.get('contact')?.invalid && updateForm.get('contact')?.touched">
                  Contact information is required
                </div>
              </div>

              <div class="form-group">
                <label for="update_size">Company Size *</label>
                <input 
                  type="text" 
                  id="update_size"
                  formControlName="size"
                  class="form-input">
                <div class="error-message" *ngIf="updateForm.get('size')?.invalid && updateForm.get('size')?.touched">
                  Company size is required
                </div>
              </div>

              <div class="form-group">
                <label for="update_established">Year Established *</label>
                <input 
                  type="text" 
                  id="update_established"
                  formControlName="established"
                  class="form-input">
                <div class="error-message" *ngIf="updateForm.get('established')?.invalid && updateForm.get('established')?.touched">
                  Year established is required
                </div>
              </div>

              <div class="form-group">
                <label for="update_revenue">Revenue Range *</label>
                <input 
                  type="text" 
                  id="update_revenue"
                  formControlName="revenue"
                  class="form-input">
                <div class="error-message" *ngIf="updateForm.get('revenue')?.invalid && updateForm.get('revenue')?.touched">
                  Revenue range is required
                </div>
              </div>

              <!-- Market Segments -->
              <div class="form-group">
                <label>Market Segments</label>
                <div formArrayName="market_segments" class="array-inputs">
                  <div *ngFor="let segment of updateMarketSegmentsArray.controls; let i = index" class="array-item">
                    <input 
                      type="text" 
                      [formControlName]="i"
                      class="form-input"
                      placeholder="Enter market segment">
                    <button type="button" class="remove-btn" (click)="removeArrayItem(updateMarketSegmentsArray, i)">❌</button>
                  </div>
                  <button type="button" class="add-btn" (click)="addArrayItem(updateMarketSegmentsArray)">➕ Add Market Segment</button>
                </div>
              </div>

              <!-- Technology Focus -->
              <div class="form-group">
                <label>Technology Focus</label>
                <div formArrayName="technology_focus" class="array-inputs">
                  <div *ngFor="let tech of updateTechnologyFocusArray.controls; let i = index" class="array-item">
                    <input 
                      type="text" 
                      [formControlName]="i"
                      class="form-input"
                      placeholder="Enter technology focus">
                    <button type="button" class="remove-btn" (click)="removeArrayItem(updateTechnologyFocusArray, i)">❌</button>
                  </div>
                  <button type="button" class="add-btn" (click)="addArrayItem(updateTechnologyFocusArray)">➕ Add Technology Focus</button>
                </div>
              </div>

              <!-- Key Markets -->
              <div class="form-group">
                <label>Key Markets</label>
                <div formArrayName="key_markets" class="array-inputs">
                  <div *ngFor="let market of updateKeyMarketsArray.controls; let i = index" class="array-item">
                    <input 
                      type="text" 
                      [formControlName]="i"
                      class="form-input"
                      placeholder="Enter key market">
                    <button type="button" class="remove-btn" (click)="removeArrayItem(updateKeyMarketsArray, i)">❌</button>
                  </div>
                  <button type="button" class="add-btn" (click)="addArrayItem(updateKeyMarketsArray)">➕ Add Key Market</button>
                </div>
              </div>

              <!-- Customer Segments -->
              <div class="form-group">
                <label>Customer Segments</label>
                <div formArrayName="customer_segments" class="array-inputs">
                  <div *ngFor="let segment of updateCustomerSegmentsArray.controls; let i = index" class="array-item">
                    <input 
                      type="text" 
                      [formControlName]="i"
                      class="form-input"
                      placeholder="Enter customer segment">
                    <button type="button" class="remove-btn" (click)="removeArrayItem(updateCustomerSegmentsArray, i)">❌</button>
                  </div>
                  <button type="button" class="add-btn" (click)="addArrayItem(updateCustomerSegmentsArray)">➕ Add Customer Segment</button>
                </div>
              </div>

              <div class="form-group">
                <label for="update_competitive_position">Competitive Position *</label>
                <textarea 
                  id="update_competitive_position"
                  formControlName="competitive_position"
                  class="form-textarea"></textarea>
                <div class="error-message" *ngIf="updateForm.get('competitive_position')?.invalid && updateForm.get('competitive_position')?.touched">
                  Competitive position is required
                </div>
              </div>

              <!-- Partnerships -->
              <div class="form-group">
                <label>Partnerships</label>
                <div formArrayName="partnerships" class="array-inputs">
                  <div *ngFor="let partner of updatePartnershipsArray.controls; let i = index" class="array-item">
                    <input 
                      type="text" 
                      [formControlName]="i"
                      class="form-input"
                      placeholder="Enter partnership">
                    <button type="button" class="remove-btn" (click)="removeArrayItem(updatePartnershipsArray, i)">❌</button>
                  </div>
                  <button type="button" class="add-btn" (click)="addArrayItem(updatePartnershipsArray)">➕ Add Partnership</button>
                </div>
              </div>

              <!-- Certifications -->
              <div class="form-group">
                <label>Certifications</label>
                <div formArrayName="certifications" class="array-inputs">
                  <div *ngFor="let cert of updateCertificationsArray.controls; let i = index" class="array-item">
                    <input 
                      type="text" 
                      [formControlName]="i"
                      class="form-input"
                      placeholder="Enter certification">
                    <button type="button" class="remove-btn" (click)="removeArrayItem(updateCertificationsArray, i)">❌</button>
                  </div>
                  <button type="button" class="add-btn" (click)="addArrayItem(updateCertificationsArray)">➕ Add Certification</button>
                </div>
              </div>

              <!-- Sales Channels -->
              <div class="form-group">
                <label>Sales Channels</label>
                <div formArrayName="sales_channels" class="array-inputs">
                  <div *ngFor="let channel of updateSalesChannelsArray.controls; let i = index" class="array-item">
                    <input 
                      type="text" 
                      [formControlName]="i"
                      class="form-input"
                      placeholder="Enter sales channel">
                    <button type="button" class="remove-btn" (click)="removeArrayItem(updateSalesChannelsArray, i)">❌</button>
                  </div>
                  <button type="button" class="add-btn" (click)="addArrayItem(updateSalesChannelsArray)">➕ Add Sales Channel</button>
                </div>
              </div>



              <!-- Submit Button -->
              <div class="form-actions">
                            <button type="submit" class="btn btn-primary" [disabled]="updateForm.invalid || updateProfileLoading">
              <span *ngIf="!updateProfileLoading">💾 Update Profile</span>
              <span *ngIf="updateProfileLoading"></span>
            </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- REGULATOR PROFILE TAB -->
    <div *ngIf="activeTab === 'regulator'" class="tab-panel">
      <div class="regulator-profile-container">
        <!-- Header -->
        <div class="header-section">
          <h1>🔍 Regulator Profile</h1>
          <p>Regulatory oversight and audit functionality for blockchain profiles</p>
        </div>

        <!-- Loading State -->
        <div *ngIf="regulatorProfileLoading" class="loading-section">
          <div class="loading-spinner">
            <div class="spinner"></div>
          </div>
        </div>

        <!-- Error State -->
        <div *ngIf="regulatorProfileError" class="error-section">
          <div class="error-message">
            <span class="error-icon">❌</span>
            <span>{{ regulatorProfileError }}</span>
          </div>
        </div>

        <!-- No Profile Available -->
        <div *ngIf="!regulatorProfileLoading && !regulatorProfileError && !regulatorProfileData" class="no-profile-section">
          <div class="no-profile-card">
            <div class="no-profile-icon">📋</div>
            <h2>No Profile Available</h2>
            <p>No company profiles are currently available for regulatory oversight.</p>
            <p>Create a profile in the "Create Profile" tab to view it here.</p>
          </div>
        </div>

        <!-- Regulator Profile Data -->
        <div *ngIf="!regulatorProfileLoading && !regulatorProfileError && regulatorProfileData" class="regulator-content">
          
          <!-- Current Profile Section -->
          <div class="current-profile-section">
            <h2>📊 Current Profile Data</h2>
            <div class="profile-card">
              <div class="profile-header">
                <h3>{{ regulatorProfileData.current_profile.company_name || 'Unnamed Company' }}</h3>
                <span class="profile-status">Current Version</span>
              </div>
              
              <div class="profile-details">
                <div class="detail-row">
                  <span class="label">Company Name:</span>
                  <span class="value">{{ regulatorProfileData.current_profile.company_name || 'N/A' }}</span>
                </div>
                <div class="detail-row">
                  <span class="label">Location:</span>
                  <span class="value">{{ regulatorProfileData.current_profile.location || 'N/A' }}</span>
                </div>
                <div class="detail-row">
                  <span class="label">Contact:</span>
                  <span class="value">{{ regulatorProfileData.current_profile.contact || 'N/A' }}</span>
                </div>
                <div class="detail-row">
                  <span class="label">Size:</span>
                  <span class="value">{{ regulatorProfileData.current_profile.size || 'N/A' }}</span>
                </div>
                <div class="detail-row">
                  <span class="label">Established:</span>
                  <span class="value">{{ regulatorProfileData.current_profile.established || 'N/A' }}</span>
                </div>
                <div class="detail-row">
                  <span class="label">Revenue:</span>
                  <span class="value">{{ regulatorProfileData.current_profile.revenue || 'N/A' }}</span>
                </div>
                <div class="detail-row">
                  <span class="label">Competitive Position:</span>
                  <span class="value">{{ regulatorProfileData.current_profile.competitive_position || 'N/A' }}</span>
                </div>
                
                <!-- Arrays -->
                <div class="detail-row" *ngIf="regulatorProfileData.current_profile.market_segments?.length">
                  <span class="label">Market Segments:</span>
                  <span class="value">{{ regulatorProfileData.current_profile.market_segments.join(', ') }}</span>
                </div>
                <div class="detail-row" *ngIf="regulatorProfileData.current_profile.technology_focus?.length">
                  <span class="label">Technology Focus:</span>
                  <span class="value">{{ regulatorProfileData.current_profile.technology_focus.join(', ') }}</span>
                </div>
                <div class="detail-row" *ngIf="regulatorProfileData.current_profile.key_markets?.length">
                  <span class="label">Key Markets:</span>
                  <span class="value">{{ regulatorProfileData.current_profile.key_markets.join(', ') }}</span>
                </div>
                <div class="detail-row" *ngIf="regulatorProfileData.current_profile.customer_segments?.length">
                  <span class="label">Customer Segments:</span>
                  <span class="value">{{ regulatorProfileData.current_profile.customer_segments.join(', ') }}</span>
                </div>
                <div class="detail-row" *ngIf="regulatorProfileData.current_profile.partnerships?.length">
                  <span class="label">Partnerships:</span>
                  <span class="value">{{ regulatorProfileData.current_profile.partnerships.join(', ') }}</span>
                </div>
                <div class="detail-row" *ngIf="regulatorProfileData.current_profile.certifications?.length">
                  <span class="label">Certifications:</span>
                  <span class="value">{{ regulatorProfileData.current_profile.certifications.join(', ') }}</span>
                </div>
                <div class="detail-row" *ngIf="regulatorProfileData.current_profile.sales_channels?.length">
                  <span class="label">Sales Channels:</span>
                  <span class="value">{{ regulatorProfileData.current_profile.sales_channels.join(', ') }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Profile History Section -->
          <div class="profile-history-section">
            <h2>📋 Complete Profile History</h2>
            <div class="history-info">
              <p>Total versions: {{ regulatorProfileData.history.length }}</p>
            </div>
            
            <div class="history-timeline">
              <div *ngFor="let version of regulatorProfileData.history; let i = index" class="history-item">
                <div class="version-header">
                  <h3>Version {{ version.version }}</h3>
                  <span class="timestamp">{{ version.timestamp | date:'medium' }}</span>
                </div>
                
                <div class="version-details">
                  <div class="detail-row">
                    <span class="label">Profile Hash:</span>
                    <span class="value hash-value">{{ version.profile_hash }}</span>
                  </div>
                  <div class="detail-row">
                    <span class="label">Public Key:</span>
                    <span class="value hash-value">{{ version.public_key }}</span>
                  </div>
                  <div class="detail-row">
                    <span class="label">Signature:</span>
                    <span class="value hash-value">{{ version.signature }}</span>
                  </div>
                </div>

                <!-- Field Changes Summary -->
                <div *ngIf="version.change_info && version.change_info.changed_fields.length > 0" class="change-summary">
                  <h4>🔍 Field Changes in This Version</h4>
                  <div class="changed-fields-list">
                    <div *ngFor="let field of version.change_info.changed_fields" class="changed-field">
                      <span class="field-name">{{ field }}</span>
                      <span class="change-type-badge" [class]="'change-type-' + getFieldChangeType(version, field)">
                        {{ getFieldChangeTypeDetailed(version, field) }}
                      </span>
                    </div>
                  </div>
                  
                  <!-- Detailed Changes -->
                  <div class="detailed-changes">
                    <h5>Detailed Changes:</h5>
                    <div *ngFor="let field of version.change_info.changed_fields" class="field-change-item">
                      <div class="field-header">
                        <span class="field-name">{{ field }}</span>
                        <span class="change-type-badge" [class]="'change-type-' + getFieldChangeType(version, field)">
                          {{ getFieldChangeTypeDetailed(version, field) }}
                        </span>
                      </div>
                      <div class="change-values">
                        <div class="old-value">
                          <span class="label">Old Value:</span>
                          <span class="value">{{ formatFieldValue(getFieldOldValue(version, field)) }}</span>
                        </div>
                        <div class="new-value">
                          <span class="label">New Value:</span>
                          <span class="value">{{ formatFieldValue(getFieldNewValue(version, field)) }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="version-profile-data">
                  <h4>Profile Data (Version {{ version.version }})</h4>
                  <div class="profile-details">
                    <div class="detail-row">
                      <span class="label">Company Name:</span>
                      <span class="value">{{ version.profile_data.company_name || 'N/A' }}</span>
                    </div>
                    <div class="detail-row">
                      <span class="label">Location:</span>
                      <span class="value">{{ version.profile_data.location || 'N/A' }}</span>
                    </div>
                    <div class="detail-row">
                      <span class="label">Contact:</span>
                      <span class="value">{{ version.profile_data.contact || 'N/A' }}</span>
                    </div>
                    <div class="detail-row">
                      <span class="label">Size:</span>
                      <span class="value">{{ version.profile_data.size || 'N/A' }}</span>
                    </div>
                    <div class="detail-row">
                      <span class="label">Established:</span>
                      <span class="value">{{ version.profile_data.established || 'N/A' }}</span>
                    </div>
                    <div class="detail-row">
                      <span class="label">Revenue:</span>
                      <span class="value">{{ version.profile_data.revenue || 'N/A' }}</span>
                    </div>
                    <div class="detail-row">
                      <span class="label">Competitive Position:</span>
                      <span class="value">{{ version.profile_data.competitive_position || 'N/A' }}</span>
                    </div>
                    
                    <!-- Arrays for each version -->
                    <div class="detail-row" *ngIf="version.profile_data.market_segments?.length">
                      <span class="label">Market Segments:</span>
                      <span class="value">{{ version.profile_data.market_segments.join(', ') }}</span>
                    </div>
                    <div class="detail-row" *ngIf="version.profile_data.technology_focus?.length">
                      <span class="label">Technology Focus:</span>
                      <span class="value">{{ version.profile_data.technology_focus.join(', ') }}</span>
                    </div>
                    <div class="detail-row" *ngIf="version.profile_data.key_markets?.length">
                      <span class="label">Key Markets:</span>
                      <span class="value">{{ version.profile_data.key_markets.join(', ') }}</span>
                    </div>
                    <div class="detail-row" *ngIf="version.profile_data.customer_segments?.length">
                      <span class="label">Customer Segments:</span>
                      <span class="value">{{ version.profile_data.customer_segments.join(', ') }}</span>
                    </div>
                    <div class="detail-row" *ngIf="version.profile_data.partnerships?.length">
                      <span class="label">Partnerships:</span>
                      <span class="value">{{ version.profile_data.partnerships.join(', ') }}</span>
                    </div>
                    <div class="detail-row" *ngIf="version.profile_data.certifications?.length">
                      <span class="label">Certifications:</span>
                      <span class="value">{{ version.profile_data.certifications.join(', ') }}</span>
                    </div>
                    <div class="detail-row" *ngIf="version.profile_data.sales_channels?.length">
                      <span class="label">Sales Channels:</span>
                      <span class="value">{{ version.profile_data.sales_channels.join(', ') }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</main> 