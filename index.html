<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Data System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab {
            padding: 15px 25px;
            background: none;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #4facfe;
            border-bottom-color: #4facfe;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }

        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .profile-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .profile-field {
            margin-bottom: 10px;
        }

        .profile-field strong {
            color: #333;
        }

        .qr-code {
            text-align: center;
            margin-top: 20px;
        }

        .qr-code img {
            max-width: 200px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .status-online {
            background: #28a745;
        }

        .status-offline {
            background: #dc3545;
        }

        .success-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .error-card {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        .profile-info {
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .label {
            font-weight: 600;
            opacity: 0.9;
        }

        .value {
            font-weight: 400;
            opacity: 0.8;
        }

        .verification-section {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .link-container {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        .link-input {
            flex: 1;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
        }

        .link-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .copy-btn {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .qr-section {
            margin-top: 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .qr-image {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            background: white;
            padding: 10px;
            margin: 10px 0;
        }

        .link-note,
        .qr-note {
            font-size: 14px;
            opacity: 0.8;
            margin: 10px 0 0 0;
        }

        .profile-section {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .section-title {
            color: #4facfe;
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .info-value {
            color: #333;
            font-size: 1rem;
            padding: 8px 12px;
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 4px;
        }

        .blockchain-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .blockchain-status.demo {
            background: #fff3e0;
            color: #f57c00;
            border: 1px solid #ffb74d;
        }

        .blockchain-status.live {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }

        .verification-error {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            border: 2px solid #f44336;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.2);
        }

        .error-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .error-icon {
            font-size: 2.5rem;
        }

        .error-title {
            margin: 0;
            color: #c62828;
            font-size: 1.8rem;
        }

        .timestamp-display {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #666;
        }

        .qr-container {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin: 20px 0;
        }

        .qr-container img {
            max-width: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Professional Profile Display Styles */
        .profile-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section-title {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .info-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            font-size: 1rem;
            font-weight: 500;
            color: #333;
            word-break: break-word;
        }

        .timestamp-display {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            background: rgba(102, 126, 234, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        /* Enhanced button styles */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Responsive design improvements */
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .info-item {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .info-label {
                flex: 0 0 40%;
            }
            
            .info-value {
                flex: 1;
                text-align: right;
            }
        }

        /* Enhanced form styling for comprehensive profile */
        .form-section-title {
            color: #4facfe;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 30px 0 20px 0;
            padding: 10px 0;
            border-bottom: 2px solid #e8f4fd;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-section-title:first-of-type {
            margin-top: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .form-group input[required] + label::after,
        .form-group label[for*="firstName"]::after,
        .form-group label[for*="lastName"]::after,
        .form-group label[for*="email"]::after {
            content: ' *';
            color: #e74c3c;
        }

        .create-profile-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            width: 100%;
        }

        .create-profile-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .create-profile-btn:active {
            transform: translateY(0);
        }

        .professional-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 0;
        }

        .company-logo .logo-placeholder {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .company-info .company-name {
            margin: 0;
            font-size: 28px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .company-info .company-tagline {
            margin: 5px 0 0 0;
            font-size: 16px;
            opacity: 0.9;
            font-weight: 300;
        }

        .verification-professional {
            background: white;
            border-radius: 0 0 12px 12px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        }

        .verification-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .verification-status {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: 600;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .verification-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .detail-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }

        .detail-card h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 18px;
            font-weight: 600;
        }

        .detail-grid {
            display: grid;
            gap: 12px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #666;
            font-size: 14px;
        }

        .detail-value {
            color: #333;
            font-weight: 500;
            text-align: right;
            max-width: 60%;
            word-break: break-word;
        }

        .blockchain-info {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border: 1px solid #2196f3;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .verification-footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
            color: #666;
            font-size: 14px;
        }

        .timestamp-professional {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        /* Update History Styles */
        .update-history-container {
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .update-record {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            position: relative;
        }

        .update-record:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }

        .update-record.latest-update {
            border-color: #28a745;
            background: linear-gradient(135deg, #f8fff8, #e8f5e8);
        }

        .update-record.latest-update::before {
            content: "LATEST";
            position: absolute;
            top: -8px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .update-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        .update-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .update-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .update-badge.manual {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #2196f3;
        }

        .update-badge.api {
            background: #f3e5f5;
            color: #7b1fa2;
            border: 1px solid #9c27b0;
        }

        .update-badge.system {
            background: #fff3e0;
            color: #f57c00;
            border: 1px solid #ff9800;
        }

        .update-date {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #666;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .update-id {
            font-family: 'Courier New', monospace;
            font-size: 10px;
            color: #999;
            background: #f1f3f4;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .changes-count {
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .field-changes {
            display: grid;
            gap: 10px;
        }

        .field-change {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            border-left: 4px solid #dee2e6;
        }

        .field-change.created {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #f8fff8, #e8f5e8);
        }

        .field-change.updated {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, #fffdf7, #fff8e1);
        }

        .field-change.deleted {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #fff8f8, #ffebee);
        }

        .field-name {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .change-icon {
            font-size: 14px;
            width: 20px;
            text-align: center;
        }

        .field-values {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            font-size: 14px;
        }

        .old-value {
            background: #ffebee;
            color: #c62828;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            text-decoration: line-through;
            opacity: 0.8;
        }

        .new-value {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: 600;
        }

        .arrow {
            color: #666;
            font-weight: bold;
            font-size: 16px;
        }

        .hash-info {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #e9ecef;
            font-size: 11px;
            color: #666;
        }

        .hash-label {
            font-weight: 600;
            margin-right: 8px;
        }

        .hash-value {
            font-family: 'Courier New', monospace;
            background: #f1f3f4;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .history-note {
            text-align: center;
            padding: 15px;
            background: #e9ecef;
            border-radius: 8px;
            color: #666;
            font-style: italic;
            margin-top: 10px;
        }

        .no-history {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .no-history p {
            margin-top: 10px;
            font-style: italic;
        }

        /* Responsive design for update history */
        @media (max-width: 768px) {
            .update-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .field-values {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .arrow {
                transform: rotate(90deg);
                align-self: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔗 Profile Data System</h1>
            <p>Blockchain-powered profile management with Hedera integration</p>
            <div style="margin-top: 15px;">
                <span id="status-indicator" class="status-indicator status-offline"></span>
                <span id="status-text">Checking connection...</span>
                <br>
                <span id="blockchain-indicator" class="status-indicator status-offline" style="margin-top: 10px;"></span>
                <span id="blockchain-text">Checking blockchain...</span>
            </div>
        </div>

        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="showTab('create')">Create Profile</button>
                <button class="tab" onclick="showTab('read')">Read Profile</button>
                <button class="tab" onclick="showTab('update')">Update Profile</button>
                <button class="tab" onclick="showTab('verify')" id="verify-tab" style="display: none;">Verify Profile</button>
            </div>

            <!-- Create Profile Tab -->
            <div id="create-tab" class="tab-content active">
                <h2>Create New Profile</h2>
                <form id="create-form">
                    <!-- Personal Information Section -->
                    <h3 class="form-section-title">👤 Personal Information</h3>
                    <div class="form-row">
                    <div class="form-group">
                            <label for="create-firstName">First Name *:</label>
                            <input type="text" id="create-firstName" required />
                    </div>
                    <div class="form-group">
                            <label for="create-lastName">Last Name *:</label>
                            <input type="text" id="create-lastName" required />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-middleName">Middle Name:</label>
                            <input type="text" id="create-middleName" />
                        </div>
                        <div class="form-group">
                            <label for="create-dateOfBirth">Date of Birth:</label>
                            <input type="date" id="create-dateOfBirth" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-gender">Gender:</label>
                            <select id="create-gender">
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                                <option value="prefer-not-to-say">Prefer not to say</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="create-nationality">Nationality:</label>
                            <input type="text" id="create-nationality" placeholder="e.g., American, British" />
                        </div>
                    </div>

                    <!-- Contact Information Section -->
                    <h3 class="form-section-title">📞 Contact Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-email">Email Address *:</label>
                        <input type="email" id="create-email" required />
                    </div>
                    <div class="form-group">
                            <label for="create-phone">Phone Number:</label>
                            <input type="tel" id="create-phone" placeholder="+1 (555) 123-4567" />
                    </div>
                    </div>
                    <div class="form-row">
                    <div class="form-group">
                            <label for="create-alternateEmail">Alternate Email:</label>
                            <input type="email" id="create-alternateEmail" />
                        </div>
                        <div class="form-group">
                            <label for="create-alternatePhone">Alternate Phone:</label>
                            <input type="tel" id="create-alternatePhone" />
                        </div>
                    </div>

                    <!-- Address Information Section -->
                    <h3 class="form-section-title">🏠 Address Information</h3>
                    <div class="form-group">
                        <label for="create-streetAddress">Street Address:</label>
                        <input type="text" id="create-streetAddress" placeholder="123 Main Street" />
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-city">City:</label>
                            <input type="text" id="create-city" />
                        </div>
                        <div class="form-group">
                            <label for="create-state">State/Province:</label>
                            <input type="text" id="create-state" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-postalCode">Postal/Zip Code:</label>
                            <input type="text" id="create-postalCode" />
                        </div>
                        <div class="form-group">
                            <label for="create-country">Country:</label>
                            <input type="text" id="create-country" />
                        </div>
                    </div>

                    <!-- Professional Information Section -->
                    <h3 class="form-section-title">💼 Professional Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-company">Company/Organization:</label>
                        <input type="text" id="create-company" />
                    </div>
                        <div class="form-group">
                            <label for="create-jobTitle">Job Title:</label>
                            <input type="text" id="create-jobTitle" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-department">Department:</label>
                            <input type="text" id="create-department" />
                        </div>
                        <div class="form-group">
                            <label for="create-industry">Industry:</label>
                            <input type="text" id="create-industry" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-workPhone">Work Phone:</label>
                            <input type="tel" id="create-workPhone" />
                        </div>
                        <div class="form-group">
                            <label for="create-workEmail">Work Email:</label>
                            <input type="email" id="create-workEmail" />
                        </div>
                    </div>

                    <!-- Identification Section -->
                    <h3 class="form-section-title">🆔 Identification</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-governmentId">Government ID Number:</label>
                            <input type="text" id="create-governmentId" placeholder="SSN, National ID, etc." />
                        </div>
                        <div class="form-group">
                            <label for="create-passportNumber">Passport Number:</label>
                            <input type="text" id="create-passportNumber" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-drivingLicense">Driving License:</label>
                            <input type="text" id="create-drivingLicense" />
                        </div>
                        <div class="form-group">
                            <label for="create-taxId">Tax ID:</label>
                            <input type="text" id="create-taxId" />
                        </div>
                    </div>

                    <!-- Emergency Contact Section -->
                    <h3 class="form-section-title">🚨 Emergency Contact</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-emergencyContactName">Emergency Contact Name:</label>
                            <input type="text" id="create-emergencyContactName" />
                        </div>
                        <div class="form-group">
                            <label for="create-emergencyContactPhone">Emergency Contact Phone:</label>
                            <input type="tel" id="create-emergencyContactPhone" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="create-emergencyContactRelationship">Relationship:</label>
                        <input type="text" id="create-emergencyContactRelationship" placeholder="Spouse, Parent, Sibling, etc." />
                    </div>

                    <!-- Additional Information Section -->
                    <h3 class="form-section-title">📝 Additional Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-website">Website/Portfolio:</label>
                            <input type="url" id="create-website" placeholder="https://example.com" />
                        </div>
                        <div class="form-group">
                            <label for="create-linkedIn">LinkedIn Profile:</label>
                            <input type="url" id="create-linkedIn" placeholder="https://linkedin.com/in/username" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="create-skills">Skills (comma-separated):</label>
                        <input type="text" id="create-skills" placeholder="JavaScript, Python, Project Management" />
                    </div>
                    <div class="form-group">
                        <label for="create-languages">Languages Spoken:</label>
                        <input type="text" id="create-languages" placeholder="English, Spanish, French" />
                    </div>
                    <div class="form-group">
                        <label for="create-notes">Additional Notes:</label>
                        <textarea id="create-notes" rows="3" placeholder="Any additional information or notes"></textarea>
                    </div>

                    <button type="submit" class="btn create-profile-btn">Create Comprehensive Profile</button>
                </form>
                <div class="loading" id="create-loading">
                    <div class="spinner"></div>
                    <p>Creating profile...</p>
                </div>
                <div id="create-result" class="result"></div>
            </div>

            <!-- Read Profile Tab -->
            <div id="read-tab" class="tab-content">
                <h2>Read Profile</h2>
                <form id="read-form">
                    <div class="form-group">
                        <label for="read-userId">User ID:</label>
                        <input type="text" id="read-userId" required placeholder="Enter User ID to search" />
                    </div>
                    <button type="submit" class="btn">Read Profile</button>
                </form>
                <div class="loading" id="read-loading">
                    <div class="spinner"></div>
                    <p>Reading profile...</p>
                </div>
                <div id="read-result" class="result"></div>
            </div>

            <!-- Update Profile Tab -->
            <div id="update-tab" class="tab-content">
                <h2>Update Profile</h2>
                <form id="update-form">
                    <div class="form-group">
                        <label for="update-userId">User ID:</label>
                        <input type="text" id="update-userId" required placeholder="Enter User ID to update" />
                    </div>
                    
                    <!-- Personal Information Section -->
                    <h3 class="form-section-title">👤 Personal Information</h3>
                    <div class="form-row">
                    <div class="form-group">
                            <label for="update-firstName">First Name:</label>
                            <input type="text" id="update-firstName" placeholder="Update first name" />
                    </div>
                    <div class="form-group">
                            <label for="update-lastName">Last Name:</label>
                            <input type="text" id="update-lastName" placeholder="Update last name" />
                        </div>
                        <div class="form-group">
                            <label for="update-middleName">Middle Name:</label>
                            <input type="text" id="update-middleName" placeholder="Update middle name" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="update-dateOfBirth">Date of Birth:</label>
                            <input type="date" id="update-dateOfBirth" />
                        </div>
                        <div class="form-group">
                            <label for="update-gender">Gender:</label>
                            <select id="update-gender">
                                <option value="">Select gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                                <option value="prefer-not-to-say">Prefer not to say</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="update-nationality">Nationality:</label>
                            <input type="text" id="update-nationality" placeholder="Update nationality" />
                        </div>
                    </div>

                    <!-- Contact Information Section -->
                    <h3 class="form-section-title">📞 Contact Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="update-email">Email Address:</label>
                        <input type="email" id="update-email" placeholder="Update email address" />
                    </div>
                    <div class="form-group">
                            <label for="update-phone">Phone Number:</label>
                        <input type="tel" id="update-phone" placeholder="Update phone number" />
                    </div>
                    </div>
                    <div class="form-row">
                    <div class="form-group">
                            <label for="update-alternateEmail">Alternate Email:</label>
                            <input type="email" id="update-alternateEmail" placeholder="Update alternate email" />
                        </div>
                        <div class="form-group">
                            <label for="update-alternatePhone">Alternate Phone:</label>
                            <input type="tel" id="update-alternatePhone" placeholder="Update alternate phone" />
                        </div>
                    </div>
                    
                    <!-- Address Information Section -->
                    <h3 class="form-section-title">🏠 Address Information</h3>
                    <div class="form-group">
                        <label for="update-streetAddress">Street Address:</label>
                        <input type="text" id="update-streetAddress" placeholder="Update street address" />
                    </div>
                    <div class="form-row">
                    <div class="form-group">
                        <label for="update-city">City:</label>
                            <input type="text" id="update-city" placeholder="Update city" />
                        </div>
                        <div class="form-group">
                            <label for="update-state">State/Province:</label>
                            <input type="text" id="update-state" placeholder="Update state/province" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="update-postalCode">Postal/Zip Code:</label>
                            <input type="text" id="update-postalCode" placeholder="Update postal code" />
                    </div>
                    <div class="form-group">
                        <label for="update-country">Country:</label>
                            <input type="text" id="update-country" placeholder="Update country" />
                        </div>
                    </div>

                    <!-- Professional Information Section -->
                    <h3 class="form-section-title">💼 Professional Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="update-company">Company/Organization:</label>
                            <input type="text" id="update-company" placeholder="Update company name" />
                        </div>
                        <div class="form-group">
                            <label for="update-jobTitle">Job Title:</label>
                            <input type="text" id="update-jobTitle" placeholder="Update job title" />
                        </div>
                        <div class="form-group">
                            <label for="update-department">Department:</label>
                            <input type="text" id="update-department" placeholder="Update department" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="update-industry">Industry:</label>
                            <input type="text" id="update-industry" placeholder="Update industry" />
                        </div>
                        <div class="form-group">
                            <label for="update-workPhone">Work Phone:</label>
                            <input type="tel" id="update-workPhone" placeholder="Update work phone" />
                        </div>
                        <div class="form-group">
                            <label for="update-workEmail">Work Email:</label>
                            <input type="email" id="update-workEmail" placeholder="Update work email" />
                        </div>
                    </div>

                    <!-- Additional Information Section -->
                    <h3 class="form-section-title">📝 Additional Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="update-website">Website/Portfolio:</label>
                            <input type="url" id="update-website" placeholder="Update website" />
                        </div>
                        <div class="form-group">
                            <label for="update-linkedIn">LinkedIn Profile:</label>
                            <input type="url" id="update-linkedIn" placeholder="Update LinkedIn profile" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="update-skills">Skills (comma-separated):</label>
                        <input type="text" id="update-skills" placeholder="Update skills" />
                    </div>
                    <div class="form-group">
                        <label for="update-languages">Languages Spoken:</label>
                        <input type="text" id="update-languages" placeholder="Update languages" />
                    </div>
                    <div class="form-group">
                        <label for="update-notes">Additional Notes:</label>
                        <textarea id="update-notes" rows="3" placeholder="Update additional information or notes"></textarea>
                    </div>

                    <button type="submit" class="btn">Update Comprehensive Profile</button>
                </form>
                <div class="loading" id="update-loading">
                    <div class="spinner"></div>
                    <p>Updating profile...</p>
                </div>
                <div id="update-result" class="result"></div>
            </div>

            <!-- Verify Profile Tab -->
            <div id="verify-tab-content" class="tab-content">
                <div class="professional-header">
                    <div class="company-logo">
                        <div class="logo-placeholder">🏢</div>
                    </div>
                    <div class="company-info">
                        <h1 class="company-name">Blockchain Verification Portal</h1>
                        <p class="company-tagline">Enterprise Identity Verification System</p>
                    </div>
                </div>
                
                <div id="verification-content">
                    <div class="loading" style="display: block;">
                        <div class="spinner"></div>
                        <p>Verifying profile credentials...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'http://localhost:3000/api/v1';

        // Check API status
        async function checkApiStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/health`);
                const data = await response.json();
                
                const indicator = document.getElementById('status-indicator');
                const text = document.getElementById('status-text');
                
                if (data.status === 'healthy') {
                    indicator.className = 'status-indicator status-online';
                    text.textContent = 'API Connected';
                } else {
                    throw new Error('API not healthy');
                }
            } catch (error) {
                const indicator = document.getElementById('status-indicator');
                const text = document.getElementById('status-text');
                indicator.className = 'status-indicator status-offline';
                text.textContent = 'API Disconnected';
            }
        }

        // Check blockchain status
        async function checkBlockchainStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/blockchain/health`);
                const data = await response.json();
                
                const indicator = document.getElementById('blockchain-indicator');
                const text = document.getElementById('blockchain-text');
                
                if (data.status === 'demo_mode') {
                    indicator.className = 'status-indicator';
                    indicator.style.backgroundColor = '#ff9800';
                    text.textContent = 'Demo Mode (Mock Data)';
                    showDemoModeInstructions(data.instructions);
                    
                } else if (data.status === 'healthy') {
                    indicator.className = 'status-indicator status-online';
                    text.textContent = `Blockchain Connected (${data.operatorId})`;
                    hideDemoModeInstructions();
                    
                } else if (data.status === 'unhealthy') {
                    indicator.className = 'status-indicator status-offline';
                    text.textContent = `Connection Failed (${data.operatorId})`;
                    if (data.troubleshooting) {
                        showTroubleshooting(data.troubleshooting);
                    }
                    
                } else {
                    indicator.className = 'status-indicator status-offline';
                    text.textContent = 'Blockchain Error';
                }
            } catch (error) {
                console.error('Failed to check blockchain status:', error);
                const indicator = document.getElementById('blockchain-indicator');
                const text = document.getElementById('blockchain-text');
                indicator.className = 'status-indicator status-offline';
                text.textContent = 'Status Check Failed';
            }
        }

        function showDemoModeInstructions(instructions) {
            let instructionsDiv = document.getElementById('demo-instructions');
            if (!instructionsDiv) {
                instructionsDiv = document.createElement('div');
                instructionsDiv.id = 'demo-instructions';
                instructionsDiv.style.cssText = `
                    background: linear-gradient(135deg, #fff3e0, #ffe0b2);
                    border: 2px solid #ff9800;
                    border-radius: 12px;
                    padding: 20px;
                    margin: 20px 0;
                    box-shadow: 0 4px 12px rgba(255, 152, 0, 0.2);
                `;
                
                // Insert after the header
                const header = document.querySelector('.header');
                header.parentNode.insertBefore(instructionsDiv, header.nextSibling);
            }
            
            instructionsDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                    <span style="font-size: 24px;">🔑</span>
                    <h3 style="margin: 0; color: #e65100;">${instructions.title}</h3>
                </div>
                <ol style="margin: 0; padding-left: 20px; line-height: 1.6;">
                    ${instructions.steps.map(step => `<li style="margin: 8px 0;">${step}</li>`).join('')}
                </ol>
                <div style="margin-top: 15px; padding: 10px; background: rgba(255, 152, 0, 0.1); border-radius: 8px;">
                    <strong>💡 Pro Tip:</strong> The Hedera Developer Portal gives you <strong>1000 free HBAR</strong> for testing!
                </div>
            `;
        }

        function hideDemoModeInstructions() {
            const instructionsDiv = document.getElementById('demo-instructions');
            if (instructionsDiv) {
                instructionsDiv.remove();
            }
        }

        function showTroubleshooting(troubleshooting) {
            let troubleshootingDiv = document.getElementById('troubleshooting');
            if (!troubleshootingDiv) {
                troubleshootingDiv = document.createElement('div');
                troubleshootingDiv.id = 'troubleshooting';
                troubleshootingDiv.style.cssText = `
                    background: linear-gradient(135deg, #fce4ec, #f8bbd9);
                    border: 2px solid #e91e63;
                    border-radius: 12px;
                    padding: 20px;
                    margin: 20px 0;
                    box-shadow: 0 4px 12px rgba(233, 30, 99, 0.2);
                `;
                
                const header = document.querySelector('.header');
                header.parentNode.insertBefore(troubleshootingDiv, header.nextSibling);
            }
            
            troubleshootingDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                    <span style="font-size: 24px;">🔧</span>
                    <h3 style="margin: 0; color: #ad1457;">Troubleshooting Steps:</h3>
                </div>
                <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                    ${troubleshooting.map(step => `<li style="margin: 8px 0;">${step}</li>`).join('')}
                </ul>
                <div style="margin-top: 15px; padding: 10px; background: rgba(233, 30, 99, 0.1); border-radius: 8px;">
                    <strong>💡 Tip:</strong> Make sure your account has sufficient HBAR balance and the private key is correct.
                </div>
            `;
        }

        function hideTroubleshooting() {
            const troubleshootingDiv = document.getElementById('troubleshooting');
            if (troubleshootingDiv) {
                troubleshootingDiv.remove();
            }
        }

        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            if (tabName === 'verify') {
                document.getElementById('verify-tab-content').classList.add('active');
                document.getElementById('verify-tab').classList.add('active');
            } else {
                document.getElementById(`${tabName}-tab`).classList.add('active');
                event.target.classList.add('active');
            }
        }

        // Check if this is a verification request
        function checkVerificationRequest() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('profileId') && urlParams.has('userId')) {
                // Hide all tabs and show only verification
                hideAllTabsExceptVerification();
                
                // Show professional verification interface
                showProfessionalVerification(urlParams);
                return true;
            }
            return false;
        }

        function hideAllTabsExceptVerification() {
            // Hide tab navigation
            const tabsContainer = document.querySelector('.tabs');
            if (tabsContainer) tabsContainer.style.display = 'none';
            
            // Hide all tab content except verification
            const allTabs = document.querySelectorAll('.tab-content');
            allTabs.forEach(tab => {
                if (tab.id !== 'verify-tab-content') {
                    tab.style.display = 'none';
                }
            });
            
            // Show only verification tab
            const verifyTab = document.getElementById('verify-tab-content');
            if (verifyTab) {
                verifyTab.style.display = 'block';
            }
            
            // Hide header description and status indicators for clean verification portal
            const header = document.querySelector('.header');
            if (header) {
                // Keep the main title but hide the description and status
                const title = header.querySelector('h1');
                const description = header.querySelector('p');
                const statusDiv = header.querySelector('div[style*="margin-top: 15px"]');
                
                if (title) {
                    title.textContent = '🔗 Blockchain Verification Portal';
                }
                if (description) {
                    description.style.display = 'none';
                }
                if (statusDiv) {
                    statusDiv.style.display = 'none';
                }
            }
            
            // Hide any other UI elements that shouldn't appear in verification mode
            const container = document.querySelector('.container');
            if (container) {
                container.style.maxWidth = '800px';
                container.style.margin = '20px auto';
            }
        }

        async function showProfessionalVerification(urlParams) {
            const profileId = urlParams.get('profileId');
            const userId = urlParams.get('userId');
            const timestamp = urlParams.get('timestamp');
            const signature = urlParams.get('signature');
            const hash = urlParams.get('hash');
            const isPublic = urlParams.get('public') === 'true'; // Add check for public parameter

            const verificationContent = document.getElementById('verification-content');
            
            try {
                // Call verification API
                const response = await fetch(`${API_BASE_URL}/blockchain/verify?profileId=${profileId}&userId=${userId}&timestamp=${timestamp}&signature=${signature}&hash=${hash}`);
                const data = await response.json();
                
                if (data.status === 'verified') {
                    verificationContent.innerHTML = createProfessionalVerificationHTML(data, isPublic);
                } else {
                    verificationContent.innerHTML = createProfessionalErrorHTML(data);
                }
            } catch (error) {
                verificationContent.innerHTML = createProfessionalErrorHTML({
                    status: 'error',
                    message: 'Verification system temporarily unavailable',
                    timestamp: new Date().toISOString(),
                    profileId,
                    userId
                });
            }
        }

        // Create professional verification success HTML
        function createProfessionalVerificationHTML(data, isPublic) {
            const profile = data.profile;
            const verification = data.verification;
            const blockchain = data.blockchain;
            
            return `
                <div class="verification-professional">
                    <div class="verification-header">
                        <div class="verification-status">
                            <span>✅</span>
                            <span>Profile Successfully Verified</span>
                        </div>
                        <h2 style="margin: 0; color: #333; font-size: 24px;">Identity Verification Complete</h2>
                        <p style="margin: 10px 0 0 0; color: #666;">This profile has been cryptographically verified on the blockchain</p>
                    </div>

                    <div class="verification-details">
                        <div class="detail-card">
                            <h4>👤 Personal Information</h4>
                            <div class="detail-grid">
                                ${profile.data.firstName ? `<div class="detail-item"><span class="detail-label">First Name</span><span class="detail-value">${profile.data.firstName}</span></div>` : ''}
                                ${profile.data.lastName ? `<div class="detail-item"><span class="detail-label">Last Name</span><span class="detail-value">${profile.data.lastName}</span></div>` : ''}
                                ${profile.data.email ? `<div class="detail-item"><span class="detail-label">Email</span><span class="detail-value">${profile.data.email}</span></div>` : ''}
                                ${profile.data.phone ? `<div class="detail-item"><span class="detail-label">Phone</span><span class="detail-value">${profile.data.phone}</span></div>` : ''}
                                ${profile.data.nationality ? `<div class="detail-item"><span class="detail-label">Nationality</span><span class="detail-value">${profile.data.nationality}</span></div>` : ''}
                            </div>
                        </div>

                        <div class="detail-card">
                            <h4>💼 Professional Information</h4>
                            <div class="detail-grid">
                                ${profile.data.company ? `<div class="detail-item"><span class="detail-label">Company</span><span class="detail-value">${profile.data.company}</span></div>` : ''}
                                ${profile.data.jobTitle ? `<div class="detail-item"><span class="detail-label">Job Title</span><span class="detail-value">${profile.data.jobTitle}</span></div>` : ''}
                                ${profile.data.department ? `<div class="detail-item"><span class="detail-label">Department</span><span class="detail-value">${profile.data.department}</span></div>` : ''}
                                ${profile.data.industry ? `<div class="detail-item"><span class="detail-label">Industry</span><span class="detail-value">${profile.data.industry}</span></div>` : ''}
                                ${profile.data.workEmail ? `<div class="detail-item"><span class="detail-label">Work Email</span><span class="detail-value">${profile.data.workEmail}</span></div>` : ''}
                            </div>
                        </div>

                        <div class="detail-card">
                            <h4>📍 Location Information</h4>
                            <div class="detail-grid">
                                ${profile.data.city ? `<div class="detail-item"><span class="detail-label">City</span><span class="detail-value">${profile.data.city}</span></div>` : ''}
                                ${profile.data.state ? `<div class="detail-item"><span class="detail-label">State/Province</span><span class="detail-value">${profile.data.state}</span></div>` : ''}
                                ${profile.data.country ? `<div class="detail-item"><span class="detail-label">Country</span><span class="detail-value">${profile.data.country}</span></div>` : ''}
                                ${profile.data.postalCode ? `<div class="detail-item"><span class="detail-label">Postal Code</span><span class="detail-value">${profile.data.postalCode}</span></div>` : ''}
                            </div>
                        </div>

                        ${!isPublic ? `
                        <div class="detail-card">
                            <h4>📋 Update History</h4>
                            ${profile.updateHistory && profile.updateHistory.length > 0 ? `
                                <div class="detail-grid">
                                    ${profile.updateHistory.slice(0, 5).map((update, index) => `
                                        <div class="detail-item" style="grid-column: 1 / -1; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 10px;">
                                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                                <span class="detail-label">Update #${profile.updateHistory.length - index}</span>
                                                <span class="detail-value timestamp-professional">${new Date(update.timestamp).toLocaleString()}</span>
                                            </div>
                                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">
                                                <strong>Source:</strong> ${update.updateSource}
                                            </div>
                                            <div style="font-size: 12px; color: #666;">
                                                <strong>Fields Changed:</strong>
                                                <div style="margin-top: 5px; padding-left: 10px;">
                                                    ${update.changedFields.map(field => `
                                                        <div style="margin-bottom: 3px;">
                                                            • <strong>${field.fieldName}</strong>: ${field.oldValue === undefined ? 'created' : field.newValue === null ? 'removed' : 'updated'}
                                                        </div>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                    ${profile.updateHistory.length > 5 ? `
                                        <div style="text-align: center; color: #666; font-size: 12px; font-style: italic;">
                                            Showing latest 5 updates. Total: ${profile.updateHistory.length} updates
                                        </div>
                                    ` : ''}
                                </div>
                            ` : `
                                <div style="text-align: center; padding: 20px; color: #666;">
                                    <span style="font-size: 2rem; opacity: 0.3;">📝</span>
                                    <p>No update history available for this profile.</p>
                                </div>
                            `}
                        </div>
                        ` : ''}

                        <div class="detail-card">
                            <h4>🔐 Verification Details</h4>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Profile ID</span>
                                    <span class="detail-value timestamp-professional">${profile.id}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">User ID</span>
                                    <span class="detail-value timestamp-professional">${profile.userId}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Verified At</span>
                                    <span class="detail-value timestamp-professional">${new Date(verification.verifiedAt).toLocaleString()}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Created At</span>
                                    <span class="detail-value timestamp-professional">${new Date(profile.createdAt).toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="blockchain-info">
                        <h4 style="margin: 0 0 15px 0; color: #1976d2;">🔗 Blockchain Network Information</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div class="detail-item">
                                <span class="detail-label">Network</span>
                                <span class="detail-value">${blockchain.network}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Operator ID</span>
                                <span class="detail-value timestamp-professional">${blockchain.operatorId}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Mode</span>
                                <span class="detail-value">${blockchain.isDemo ? 'Demo Mode' : 'Live Network'}</span>
                            </div>
                        </div>
                    </div>

                    <div class="verification-footer">
                        <p><strong>This verification was generated automatically by our blockchain-secured identity system.</strong></p>
                        <p>For questions about this verification, please contact the issuing organization.</p>
                        <p style="margin-top: 15px; font-size: 12px; opacity: 0.8;">
                            Powered by Blockchain Verification Portal • Secured by Hedera Hashgraph
                        </p>
                    </div>
                </div>
            `;
        }

        // Create professional verification error HTML
        function createProfessionalErrorHTML(data) {
            return `
                <div class="verification-professional">
                    <div class="verification-header">
                        <div style="
                            display: inline-flex;
                            align-items: center;
                            gap: 10px;
                            background: linear-gradient(135deg, #f44336, #d32f2f);
                            color: white;
                            padding: 12px 24px;
                            border-radius: 30px;
                            font-weight: 600;
                            margin-bottom: 15px;
                            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
                        ">
                            <span>❌</span>
                            <span>Verification Failed</span>
                        </div>
                        <h2 style="margin: 0; color: #333; font-size: 24px;">Identity Verification Unsuccessful</h2>
                        <p style="margin: 10px 0 0 0; color: #666;">${data.message || 'The profile could not be verified at this time'}</p>
                    </div>

                    <div class="detail-card" style="border-left-color: #f44336;">
                        <h4>❌ Error Information</h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">Status</span>
                                <span class="detail-value">${data.status}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Timestamp</span>
                                <span class="detail-value timestamp-professional">${new Date(data.timestamp).toLocaleString()}</span>
                            </div>
                            ${data.profileId ? `
                                <div class="detail-item">
                                    <span class="detail-label">Profile ID</span>
                                    <span class="detail-value timestamp-professional">${data.profileId}</span>
                                </div>
                            ` : ''}
                            ${data.userId ? `
                                <div class="detail-item">
                                    <span class="detail-label">User ID</span>
                                    <span class="detail-value timestamp-professional">${data.userId}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>

                    <div style="background: rgba(244, 67, 54, 0.1); border-radius: 12px; padding: 20px; margin-top: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #c62828;">🔧 Possible Solutions</h4>
                        <ul style="margin: 0; padding-left: 20px; color: #d32f2f;">
                            <li>Verify that the verification link is complete and unmodified</li>
                            <li>Check that the link has not expired</li>
                            <li>Contact the organization that issued this verification</li>
                            <li>Ensure you have a stable internet connection</li>
                        </ul>
                    </div>

                    <div class="verification-footer">
                        <p><strong>If you believe this is an error, please contact technical support.</strong></p>
                        <p style="margin-top: 15px; font-size: 12px; opacity: 0.8;">
                            Powered by Blockchain Verification Portal • Secured by Hedera Hashgraph
                        </p>
                    </div>
                </div>
            `;
        }

        // Generate UUID
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Show result
        function showResult(elementId, message, isSuccess = true) {
            const resultElement = document.getElementById(elementId);
            resultElement.className = `result ${isSuccess ? 'success' : 'error'}`;
            resultElement.innerHTML = message;
            resultElement.style.display = 'block';
        }

        // Show loading
        function showLoading(elementId, show = true) {
            document.getElementById(elementId).style.display = show ? 'block' : 'none';
        }

        // Create Profile
        document.getElementById('create-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            showLoading('create-loading', true);
            
            // Collect comprehensive profile data
            const profileData = {
                // Personal Information
                firstName: document.getElementById('create-firstName').value,
                lastName: document.getElementById('create-lastName').value,
                middleName: document.getElementById('create-middleName').value || '',
                fullName: `${document.getElementById('create-firstName').value} ${document.getElementById('create-middleName').value} ${document.getElementById('create-lastName').value}`.replace(/\s+/g, ' ').trim(),
                dateOfBirth: document.getElementById('create-dateOfBirth').value || '',
                gender: document.getElementById('create-gender').value || '',
                nationality: document.getElementById('create-nationality').value || '',
                
                // Contact Information
                email: document.getElementById('create-email').value,
                phone: document.getElementById('create-phone').value || '',
                alternateEmail: document.getElementById('create-alternateEmail').value || '',
                alternatePhone: document.getElementById('create-alternatePhone').value || '',
                
                // Address Information
                streetAddress: document.getElementById('create-streetAddress').value || '',
                city: document.getElementById('create-city').value || '',
                state: document.getElementById('create-state').value || '',
                postalCode: document.getElementById('create-postalCode').value || '',
                country: document.getElementById('create-country').value || '',
                
                // Professional Information
                company: document.getElementById('create-company').value || '',
                jobTitle: document.getElementById('create-jobTitle').value || '',
                department: document.getElementById('create-department').value || '',
                industry: document.getElementById('create-industry').value || '',
                workPhone: document.getElementById('create-workPhone').value || '',
                workEmail: document.getElementById('create-workEmail').value || '',
                
                // Identification
                governmentId: document.getElementById('create-governmentId').value || '',
                passportNumber: document.getElementById('create-passportNumber').value || '',
                drivingLicense: document.getElementById('create-drivingLicense').value || '',
                taxId: document.getElementById('create-taxId').value || '',
                
                // Emergency Contact
                emergencyContactName: document.getElementById('create-emergencyContactName').value || '',
                emergencyContactPhone: document.getElementById('create-emergencyContactPhone').value || '',
                emergencyContactRelationship: document.getElementById('create-emergencyContactRelationship').value || '',
                
                // Additional Information
                website: document.getElementById('create-website').value || '',
                linkedIn: document.getElementById('create-linkedIn').value || '',
                skills: document.getElementById('create-skills').value || '',
                languages: document.getElementById('create-languages').value || '',
                notes: document.getElementById('create-notes').value || ''
            };

            try {
                const response = await fetch(`${API_BASE_URL}/blockchain/profile`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(profileData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    const publicVerificationLink = result.verificationLink + '&public=true';
                    let message = `
                        <div class="success-card">
                            <h3>✅ Comprehensive Profile Created Successfully!</h3>
                            <div class="profile-info">
                                <div class="info-row">
                                    <span class="label">Profile ID:</span>
                                    <span class="value">${result.profile.id}</span>
                                </div>
                                <div class="info-row">
                                    <span class="label">User ID:</span>
                                    <span class="value">${result.profile.userId}</span>
                                </div>
                                <div class="info-row">
                                    <span class="label">Full Name:</span>
                                    <span class="value">${profileData.fullName}</span>
                                </div>
                                <div class="info-row">
                                    <span class="label">Email:</span>
                                    <span class="value">${profileData.email}</span>
                                </div>
                                <div class="info-row">
                                    <span class="label">Created:</span>
                                    <span class="value">${new Date(result.profile.createdAt).toLocaleString()}</span>
                                </div>
                            </div>
                            
                            <!-- First Verification Link and QR Code (Private) -->
                            <div class="verification-section">
                                <h4>🔗 Verification Link</h4>
                                <div class="link-container">
                                    <input type="text" value="${result.verificationLink}" readonly class="link-input" id="verification-link-1">
                                    <button onclick="copyToClipboard('verification-link-1')" class="copy-btn">📋 Copy</button>
                                </div>
                                <p class="link-note">Click the link above to verify the profile on the blockchain</p>
                            </div>

                            ${result.qrCode ? `
                                <div class="qr-section">
                                    <h4>📱 QR Code</h4>
                                    <div id="qr-code-container-create-1"></div>
                                    <p class="qr-note">Scan with your phone to access the verification link</p>
                                </div>
                            ` : ''}

                            <!-- Second Verification Link and QR Code (Public) -->
                            <div class="verification-section" style="margin-top: 20px; border-top: 2px solid #eee; padding-top: 20px; background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); border-radius: 12px; padding: 20px;">
                                <h4>🔗 Public Verification Link</h4>
                                <div class="link-container">
                                    <input type="text" value="${publicVerificationLink}" readonly class="link-input" id="verification-link-2">
                                    <button onclick="copyToClipboard('verification-link-2')" class="copy-btn">📋 Copy</button>
                                </div>
                                <p class="link-note">Click the link above to verify the profile on the blockchain (Public view without update history)</p>
                            </div>

                            ${result.qrCode ? `
                                <div class="qr-section" style="background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); border-radius: 12px; padding: 20px;">
                                    <h4>📱 Public QR Code</h4>
                                    <div id="qr-code-container-create-2"></div>
                                    <p class="qr-note">Scan with your phone to access the public verification link</p>
                                </div>
                            ` : ''}
                        </div>
                    `;
                    
                    showResult('create-result', message, true);
                    
                    // Generate proper QR codes after showing result
                    if (result.verificationLink) {
                        setTimeout(() => {
                            generateQRCode(result.verificationLink, 'qr-code-container-create-1');
                            generateQRCode(result.verificationLink, 'qr-code-container-create-2');
                        }, 100);
                    }
                    
                    document.getElementById('create-form').reset();
                } else {
                    throw new Error(result.error || 'Failed to create profile');
                }
            } catch (error) {
                let errorMessage = `
                    <div class="error-card">
                        <h3>❌ Error Creating Profile</h3>
                        <p><strong>Details:</strong> ${error.message}</p>
                    </div>
                `;
                
                showResult('create-result', errorMessage, false);
            } finally {
                showLoading('create-loading', false);
            }
        });

        // Read Profile
        document.getElementById('read-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            showLoading('read-loading', true);
            
            const userId = document.getElementById('read-userId').value;

            try {
                const response = await fetch(`${API_BASE_URL}/blockchain/profile/${userId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const result = await response.json();
                
                if (response.ok) {
                    let message = `
                        <div class="success-card">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <span style="font-size: 2rem;">✅</span>
                                <div>
                                    <h3 style="margin: 0; color: #155724;">Profile Found Successfully!</h3>
                                    <p style="margin: 5px 0 0 0; color: #155724; opacity: 0.8;">Retrieved from blockchain storage</p>
                                </div>
                            </div>
                        </div>

                        <div class="profile-section">
                            <h4 class="section-title">📋 Profile Information</h4>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">Profile ID</span>
                                    <span class="info-value">${result.id}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">User ID</span>
                                    <span class="info-value">${result.userId}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Created At</span>
                                    <span class="info-value timestamp-display">${new Date(result.createdAt).toLocaleString()}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Last Updated</span>
                                    <span class="info-value timestamp-display">${new Date(result.updatedAt).toLocaleString()}</span>
                                </div>
                            </div>
                        </div>

                        <div class="profile-section">
                            <h4 class="section-title">👤 Personal Details</h4>
                            <div class="info-grid">
                                ${Object.entries(result.data)
                                    .filter(([key]) => key !== 'fullName') // Remove fullName from display
                                    .map(([key, value]) => `
                                    <div class="info-item">
                                        <span class="info-label">${formatFieldName(key)}</span>
                                        <span class="info-value">${value || 'Not provided'}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        ${result.updateHistory && result.updateHistory.length > 0 ? `
                        <div class="profile-section">
                            <h4 class="section-title">📋 Update History</h4>
                            <div class="update-history-container">
                                ${result.updateHistory.slice(-10).reverse().map((update, index) => `
                                    <div class="update-record ${index === 0 ? 'latest-update' : ''}">
                                        <div class="update-header">
                                            <div class="update-info">
                                                <span class="update-badge ${getUpdateBadgeClass(update.updateSource)}">${formatUpdateSource(update.updateSource)}</span>
                                                <span class="update-date">${new Date(update.timestamp).toLocaleString()}</span>
                                                <span class="update-id">ID: ${update.updateId.substring(0, 8)}</span>
                            </div>
                                            <div class="changes-count">
                                                ${update.changedFields.length} field${update.changedFields.length !== 1 ? 's' : ''} changed
                        </div>
                                        </div>
                                        <div class="field-changes">
                                            ${update.changedFields.map(change => `
                                                <div class="field-change ${change.changeType}">
                                                    <div class="field-name">
                                                        <span class="change-icon">${getChangeIcon(change.changeType)}</span>
                                                        ${formatFieldName(change.fieldName)}
                                                    </div>
                                                    <div class="field-values">
                                                        ${change.changeType === 'created' ? `
                                                            <span class="new-value">Added: "${change.newValue}"</span>
                                                        ` : change.changeType === 'updated' ? `
                                                            <span class="old-value">From: "${change.previousValue || 'Empty'}"</span>
                                                            <span class="arrow">→</span>
                                                            <span class="new-value">To: "${change.newValue}"</span>
                                                        ` : `
                                                            <span class="old-value">Removed: "${change.previousValue}"</span>
                                                        `}
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                        ${update.previousHash && update.newHash ? `
                                            <div class="hash-info">
                                                <span class="hash-label">Data Hash:</span>
                                                <span class="hash-value">${update.previousHash} → ${update.newHash}</span>
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')}
                                ${result.updateHistory.length > 10 ? `
                                    <div class="history-note">
                                        Showing latest 10 updates. Total: ${result.updateHistory.length} updates
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        ` : `
                        <div class="profile-section">
                            <h4 class="section-title">📋 Update History</h4>
                            <div class="no-history">
                                <span style="font-size: 2rem; opacity: 0.3;">📝</span>
                                <p>No update history available. This profile was created before history tracking was enabled.</p>
                            </div>
                        </div>
                        `}
                    `;
                    
                    showResult('read-result', message, true);
                } else if (response.status === 404) {
                    showResult('read-result', `
                        <div class="error-card">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <span style="font-size: 2rem;">🔍</span>
                                <div>
                                    <h3 style="margin: 0; color: #721c24;">Profile Not Found</h3>
                                    <p style="margin: 5px 0 0 0; color: #721c24; opacity: 0.8;">No profile exists with this User ID</p>
                                </div>
                            </div>
                            <div class="profile-section">
                                <p><strong>Searched for:</strong> ${userId}</p>
                                <div style="margin-top: 15px; padding: 15px; background: rgba(114, 28, 36, 0.1); border-radius: 8px;">
                                    <h5 style="margin: 0 0 10px 0; color: #721c24;">💡 Suggestions:</h5>
                                    <ul style="margin: 0; padding-left: 20px; color: #721c24;">
                                        <li>Double-check the User ID for typos</li>
                                        <li>Make sure you're using the correct User ID from a created profile</li>
                                        <li>Try creating a new profile first</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    `, false);
                } else {
                    throw new Error(result.error || 'Failed to read profile');
                }
            } catch (error) {
                showResult('read-result', `
                    <div class="error-card">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <span style="font-size: 2rem;">❌</span>
                            <div>
                                <h3 style="margin: 0; color: #721c24;">Error Reading Profile</h3>
                                <p style="margin: 5px 0 0 0; color: #721c24; opacity: 0.8;">Failed to retrieve profile data</p>
                            </div>
                        </div>
                        <div class="profile-section">
                            <p><strong>Error Details:</strong> ${error.message}</p>
                            <div style="margin-top: 15px; padding: 15px; background: rgba(114, 28, 36, 0.1); border-radius: 8px;">
                                <h5 style="margin: 0 0 10px 0; color: #721c24;">🔧 Troubleshooting:</h5>
                                <ul style="margin: 0; padding-left: 20px; color: #721c24;">
                                    <li>Check your internet connection</li>
                                    <li>Verify the API server is running</li>
                                    <li>Try refreshing the page</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `, false);
            } finally {
                showLoading('read-loading', false);
            }
        });

        // Update Profile
        document.getElementById('update-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            showLoading('update-loading', true);
            
            const userId = document.getElementById('update-userId').value.trim();
            
            // Validate User ID first
            if (!userId) {
                showResult('update-result', `
                    <div class="error-card">
                        <h3>❌ Validation Error</h3>
                        <p><strong>Details:</strong> User ID is required. Please enter a valid User ID.</p>
                        <div style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 4px; font-size: 12px;">
                            <strong>Tip:</strong> You can get a User ID by creating a profile first or reading an existing profile.
                        </div>
                    </div>
                `, false);
                showLoading('update-loading', false);
                return;
            }
            
            const updateData = {
                // Personal Information
                firstName: document.getElementById('update-firstName').value,
                lastName: document.getElementById('update-lastName').value,
                middleName: document.getElementById('update-middleName').value,
                dateOfBirth: document.getElementById('update-dateOfBirth').value,
                gender: document.getElementById('update-gender').value,
                nationality: document.getElementById('update-nationality').value,
                
                // Contact Information
                email: document.getElementById('update-email').value,
                phone: document.getElementById('update-phone').value,
                alternateEmail: document.getElementById('update-alternateEmail').value,
                alternatePhone: document.getElementById('update-alternatePhone').value,
                
                // Address Information
                streetAddress: document.getElementById('update-streetAddress').value,
                city: document.getElementById('update-city').value,
                state: document.getElementById('update-state').value,
                postalCode: document.getElementById('update-postalCode').value,
                country: document.getElementById('update-country').value,
                
                // Professional Information
                company: document.getElementById('update-company').value,
                jobTitle: document.getElementById('update-jobTitle').value,
                department: document.getElementById('update-department').value,
                industry: document.getElementById('update-industry').value,
                workPhone: document.getElementById('update-workPhone').value,
                workEmail: document.getElementById('update-workEmail').value,
                
                // Additional Information
                website: document.getElementById('update-website').value,
                linkedIn: document.getElementById('update-linkedIn').value,
                skills: document.getElementById('update-skills').value,
                languages: document.getElementById('update-languages').value,
                notes: document.getElementById('update-notes').value
            };

            // Remove empty fields
            Object.keys(updateData).forEach(key => {
                if (!updateData[key] || updateData[key].trim() === '') {
                    delete updateData[key];
                }
            });

            // Check if at least one field has data
            if (Object.keys(updateData).length === 0) {
                showResult('update-result', `
                    <div class="error-card">
                        <h3>❌ Validation Error</h3>
                        <p><strong>Details:</strong> Please provide at least one field to update.</p>
                        <div style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 4px; font-size: 12px;">
                            <strong>Tip:</strong> Fill in any field you want to update and try again.
                        </div>
                    </div>
                `, false);
                showLoading('update-loading', false);
                return;
            }

            try {
                console.log('Sending update request with data:', { data: updateData });
                
                const response = await fetch(`${API_BASE_URL}/blockchain/profile/${userId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ data: updateData })
                });

                const result = await response.json();
                console.log('Update response:', response.status, result);
                
                if (response.ok && result.success) {
                    let message = `
                        <div class="success-card">
                            <h3>✅ Comprehensive Profile Updated Successfully!</h3>
                            <div class="profile-info">
                                <div class="info-row">
                                    <span class="label">Profile ID:</span>
                                    <span class="value">${result.profile.id}</span>
                                </div>
                                <div class="info-row">
                                    <span class="label">User ID:</span>
                                    <span class="value">${result.profile.userId}</span>
                                </div>
                                <div class="info-row">
                                    <span class="label">Created:</span>
                                    <span class="value">${new Date(result.profile.createdAt).toLocaleString()}</span>
                                </div>
                                <div class="info-row">
                                    <span class="label">Updated:</span>
                                    <span class="value">${new Date(result.profile.updatedAt).toLocaleString()}</span>
                                </div>
                            </div>
                            
                            <div class="profile-data">
                                <h4>📋 Updated Profile Data</h4>
                                <div class="data-container">
                                    ${Object.entries(result.profile.data).map(([key, value]) => `
                                        <div class="data-row">
                                            <span class="data-label">${formatFieldName(key)}:</span>
                                            <span class="data-value">${value}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="verification-section">
                                <h4>🔗 Updated Verification Link</h4>
                                <div class="link-container">
                                    <input type="text" value="${result.verificationLink}" readonly class="link-input" id="update-verification-link">
                                    <button onclick="copyToClipboard('update-verification-link')" class="copy-btn">📋 Copy</button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    if (result.verificationLink) {
                        message += `
                            <div class="qr-section">
                                <h4>📱 Updated QR Code</h4>
                                <div id="qr-code-container-update"></div>
                                <p class="qr-note">Scan with your phone to access the updated verification link</p>
                            </div>
                        `;
                    }
                    
                    showResult('update-result', message, true);
                    
                    // Generate proper QR code after showing result
                    if (result.verificationLink) {
                        setTimeout(() => {
                            generateQRCode(result.verificationLink, 'qr-code-container-update');
                        }, 100);
                    }
                    
                    document.getElementById('update-form').reset();
                } else {
                    // Handle different types of errors
                    let errorMessage = 'Failed to update profile';
                    if (result.message) {
                        errorMessage = result.message;
                    } else if (result.error) {
                        errorMessage = result.error;
                    } else if (!response.ok) {
                        errorMessage = `Server error: ${response.status} ${response.statusText}`;
                    }
                    
                    throw new Error(errorMessage);
                }
            } catch (error) {
                console.error('Update profile error:', error);
                
                let errorDetails = error.message;
                if (error.message === 'Failed to fetch') {
                    errorDetails = 'Unable to connect to server. Please check your connection and try again.';
                } else if (error.message.includes('400')) {
                    errorDetails = 'Invalid request data. Please check all fields and try again.';
                } else if (error.message.includes('404')) {
                    errorDetails = 'Profile not found. Please verify the User ID is correct.';
                } else if (error.message.includes('500')) {
                    errorDetails = 'Server error. Please try again later.';
                }
                
                showResult('update-result', `
                    <div class="error-card">
                        <h3>❌ Error Updating Profile</h3>
                        <p><strong>Details:</strong> ${errorDetails}</p>
                        <div style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 4px; font-size: 12px;">
                            <strong>Debug Info:</strong><br>
                            User ID: ${userId || 'Not provided'}<br>
                            Fields to update: ${Object.keys(updateData).length > 0 ? Object.keys(updateData).join(', ') : 'None'}
                        </div>
                    </div>
                `, false);
            } finally {
                showLoading('update-loading', false);
            }
        });

        // Function to generate proper QR code
        function generateQRCode(text, containerId) {
            const container = document.getElementById(containerId);
            if (container) {
                // Clear existing content
                container.innerHTML = '';
                
                // Create a proper QR code using qrious library via CDN
                const qrContainer = document.createElement('div');
                qrContainer.style.cssText = `
                    text-align: center;
                    padding: 20px;
                    background: rgba(255, 255, 255, 0.95);
                    border-radius: 12px;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                    margin: 0 auto;
                    max-width: 280px;
                `;
                
                // Create canvas for QR code
                const canvas = document.createElement('canvas');
                canvas.id = `qr-canvas-${Date.now()}`;
                canvas.style.cssText = `
                    border: 2px solid #e0e0e0;
                    border-radius: 8px;
                    background: white;
                `;
                
                qrContainer.appendChild(canvas);
                
                // Add link below QR code
                const linkDiv = document.createElement('div');
                linkDiv.style.cssText = `
                    margin-top: 15px;
                    font-size: 12px;
                    color: #666;
                    word-break: break-all;
                    padding: 8px;
                    background: #f5f5f5;
                    border-radius: 4px;
                `;
                linkDiv.textContent = text;
                qrContainer.appendChild(linkDiv);
                
                // Add click handler to open link
                qrContainer.style.cursor = 'pointer';
                qrContainer.addEventListener('click', () => {
                    window.open(text, '_blank');
                });
                
                container.appendChild(qrContainer);
                
                // Generate QR code using qrious library
                try {
                    // Load qrious library if not already loaded
                    if (typeof QRious === 'undefined') {
                        const script = document.createElement('script');
                        script.src = 'https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js';
                        script.onload = () => {
                            generateQRWithLibrary(canvas, text);
                        };
                        script.onerror = () => {
                            console.warn('Failed to load QRious library, using fallback');
                            generateFallbackQR(canvas, text);
                        };
                        document.head.appendChild(script);
                    } else {
                        generateQRWithLibrary(canvas, text);
                    }
                } catch (error) {
                    console.warn('QR generation failed, using fallback:', error);
                    generateFallbackQR(canvas, text);
                }
            }
        }
        
        function generateQRWithLibrary(canvas, text) {
            try {
                const qr = new QRious({
                    element: canvas,
                    value: text,
                    size: 200,
                    level: 'M',
                    background: 'white',
                    foreground: 'black'
                });
            } catch (error) {
                console.warn('QRious library failed, using fallback:', error);
                generateFallbackQR(canvas, text);
            }
        }
        
        function generateFallbackQR(canvas, text) {
            // Fallback QR code generation
            canvas.width = 200;
            canvas.height = 200;
            const ctx = canvas.getContext('2d');
            
            // Fill background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, 200, 200);
            
            // Create pattern based on text hash
            let hash = 0;
            for (let i = 0; i < text.length; i++) {
                hash = ((hash << 5) - hash + text.charCodeAt(i)) & 0xffffffff;
            }
            
            ctx.fillStyle = '#000000';
            const moduleSize = 8;
            const modules = Math.floor(200 / moduleSize);
            
            // Draw finder patterns (corners)
            function drawFinderPattern(x, y) {
                ctx.fillRect(x, y, moduleSize * 7, moduleSize * 7);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(x + moduleSize, y + moduleSize, moduleSize * 5, moduleSize * 5);
                ctx.fillStyle = '#000000';
                ctx.fillRect(x + moduleSize * 2, y + moduleSize * 2, moduleSize * 3, moduleSize * 3);
            }
            
            drawFinderPattern(0, 0);
            drawFinderPattern((modules - 7) * moduleSize, 0);
            drawFinderPattern(0, (modules - 7) * moduleSize);
            
            // Generate data pattern
            for (let x = 0; x < modules; x++) {
                for (let y = 0; y < modules; y++) {
                    if ((x + y + hash) % 3 === 0 && !isFinderPattern(x, y, modules)) {
                        ctx.fillRect(x * moduleSize, y * moduleSize, moduleSize, moduleSize);
                    }
                }
            }
            
            // Add center overlay with better text
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.fillRect(75, 85, 50, 30);
            ctx.fillStyle = '#333';
            ctx.font = 'bold 10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('VERIFY', 100, 100);
        }
        
        function isFinderPattern(x, y, modules) {
            return (x < 9 && y < 9) || 
                   (x >= modules - 8 && y < 9) || 
                   (x < 9 && y >= modules - 8);
        }

        // Copy to clipboard function
        function copyToClipboard(inputId) {
            const input = document.getElementById(inputId);
            input.select();
            input.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                const button = input.nextElementSibling;
                const originalText = button.textContent;
                button.textContent = '✅ Copied!';
                        setTimeout(() => {
                    button.textContent = originalText;
                        }, 2000);
                } catch (err) {
                    console.error('Failed to copy: ', err);
                alert('Failed to copy to clipboard');
            }
        }

        // Utility functions
        function formatFieldName(fieldName) {
            return fieldName
                .replace(/([A-Z])/g, ' $1')
                .replace(/^./, str => str.toUpperCase())
                .replace(/([a-z])([A-Z])/g, '$1 $2')
                .trim();
        }

        function getUpdateBadgeClass(updateSource) {
            return updateSource.toLowerCase();
        }

        function formatUpdateSource(updateSource) {
            switch(updateSource) {
                case 'manual': return 'Manual Update';
                case 'api': return 'API Update';
                case 'system': return 'System Update';
                default: return updateSource;
            }
        }

        function getChangeIcon(changeType) {
            switch(changeType) {
                case 'created': return '➕';
                case 'updated': return '✏️';
                case 'deleted': return '❌';
                default: return '📝';
            }
        }

        function populateUpdateForm(userId, profileData) {
            // Switch to update tab
            document.getElementById('update-tab').click();
            
            // Populate the form with correct comprehensive field IDs that match the actual form
            document.getElementById('update-userId').value = userId;
            
            // Personal Information
            document.getElementById('update-firstName').value = profileData.firstName || '';
            document.getElementById('update-lastName').value = profileData.lastName || '';
            document.getElementById('update-middleName').value = profileData.middleName || '';
            document.getElementById('update-dateOfBirth').value = profileData.dateOfBirth || '';
            document.getElementById('update-gender').value = profileData.gender || '';
            document.getElementById('update-nationality').value = profileData.nationality || '';
            
            // Contact Information
            document.getElementById('update-email').value = profileData.email || '';
            document.getElementById('update-phone').value = profileData.phone || '';
            document.getElementById('update-alternateEmail').value = profileData.alternateEmail || '';
            document.getElementById('update-alternatePhone').value = profileData.alternatePhone || '';
            
            // Address Information
            document.getElementById('update-streetAddress').value = profileData.streetAddress || '';
            document.getElementById('update-city').value = profileData.city || '';
            document.getElementById('update-state').value = profileData.state || '';
            document.getElementById('update-postalCode').value = profileData.postalCode || '';
            document.getElementById('update-country').value = profileData.country || '';
            
            // Professional Information
            document.getElementById('update-company').value = profileData.company || '';
            document.getElementById('update-jobTitle').value = profileData.jobTitle || '';
            document.getElementById('update-department').value = profileData.department || '';
            document.getElementById('update-industry').value = profileData.industry || '';
            document.getElementById('update-workPhone').value = profileData.workPhone || '';
            document.getElementById('update-workEmail').value = profileData.workEmail || '';
            
            // Additional Information
            document.getElementById('update-website').value = profileData.website || '';
            document.getElementById('update-linkedIn').value = profileData.linkedIn || '';
            document.getElementById('update-skills').value = profileData.skills || '';
            document.getElementById('update-languages').value = profileData.languages || '';
            document.getElementById('update-notes').value = profileData.notes || '';
        }

        // Initialize
        checkApiStatus();
        setInterval(checkApiStatus, 30000); // Check every 30 seconds
        checkBlockchainStatus();
        setInterval(checkBlockchainStatus, 30000); // Check every 30 seconds
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check for verification request first
            if (!checkVerificationRequest()) {
                // If not a verification request, show normal interface
                showTab('create');
                checkAPIHealth();
        }
        });
    </script>
</body>
</html> 